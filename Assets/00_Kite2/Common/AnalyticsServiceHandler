using UnityEngine;
using Unity.Services.Core;
using Unity.Services.Analytics;
using System.Diagnostics;
using System.Collections.Generic;

public class AnalyticsServiceHandler 
{

    private static AnalyticsServiceHandler instance;

    private Stopwatch stopwatch;


    public static AnalyticsServiceHandler Instance()
    {
        if (instance == null)
        {
            instance = new AnalyticsServiceHandler();
        }
        return instance;
    }
 
    public void StartAnalytics()
    {
        await UnityServices.InitializeAsync();
        AnalyticsService.Instance.StartDataCollection();    //TODO: show the player a UI element that asks for consent.
        UnityEngine.Debug.Log("UserID: " + AnalyticsService.Instance.GetAnalyticsUserID());
        StartStopwatch();
    }

    public void StartStopwatch()
    {
        stopwatch = new Stopwatch();
        stopwatch.Start();
    }

    public long StopStopwatch()
    {
        stopwatch.Stop();
        UnityEngine.Debug.Log("Zeit seit dem Start: " + stopwatch.ElapsedMilliseconds);
        return stopwatch.ElapsedMilliseconds;
    }

    public void SendMainMenuStatistics()
    {
        stopwatch.Stop();
        Dictionary<string, object> parameters = new Dictionary<string, object>()
        {
            {"currentUserID", AnalyticsService.Instance.GetAnalyticsUserID()},
            {"millisecondsInMainMenu", stopwatch.ElapsedMilliseconds}
        };
        AnalyticsService.Instance.CustomData("mainMenuStatistics", parameters);
    }
}